<!DOCTYPE html>
<!-- This is Chromecast sender -->
<html>
<head>
  <title>Random photos from nas</title>
  <meta charset="utf-8">
  <style type="text/css">
    @import 'http://twitter.github.io/typeahead.js/css/examples.css';
    .tt-dropdown-menu {
      max-height: 300px;
      overflow-y: auto;
    }

    button {
      font-size: 24px;
      line-height: 30px;
      position: relative;
      top: 15px;
      padding: 8px;
      border-radius: 8px;
      border: 2px solid #b8b8b8;
    }
  </style>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="http://photos.azib.net/chromecast.js"></script>
  <script type="text/javascript" src="http://twitter.github.io/typeahead.js/releases/0.10.2/typeahead.jquery.js"></script>
</head>
<body>
<div class="container">
  <div class="demo">
    Send random photos from nas to Chromecast!<br><br>

    <form>
      <input class="typeahead" type="text" name="prefix" value="" placeholder="2014" autofocus>
      <button>Go</button>
      <div style="margin-top: 20px">
        <label><input type="checkbox" name="random" checked> Random</label>
      </div>
    </form>
  </div>
</div>
</body>
<script type="text/javascript">
  chromecast.appId = '40FA4E04';
  $(function () {
    setTimeout(chromecast.launch, 1000);

    var input = $('[name=prefix]').typeahead({hint: true, highlight: true, minLength: 3}, {
      name: 'photo-dirs',
      displayKey: 'value',
      source: function (dir, cb) {
        $.get('/photos_dirs.php?dir=' + dir, function (data) {
          var values = data.trim().split('\n');
          cb($.map(values, function (value) {
            return {value: value}
          }));
        });
      }
    });

    var random = $('[name=random]');

    function sendDir() {
      chromecast.message((random.is(':checked') ? 'rnd:' : 'seq:') + input.val());
    }

    input.on('typeahead:selected', sendDir);

    input.closest('form').on('submit', function() {
      sendDir();
      return false;
    });

    random.on('click', function() {
      if (input.val()) sendDir();
    });

    chromecast.onMessage(function(cmd) {
      $('button').prop('disabled', false);
    });
  });
</script>
</html>

